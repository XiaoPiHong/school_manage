"use strict";(self["webpackChunkschool_manage_ts"]=self["webpackChunkschool_manage_ts"]||[]).push([[562],{6562:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("Row",{staticClass:"pd10"},[e("Col",{attrs:{span:"24"}},[e("h1",[t._v("使用Canvas剪切图片")]),e("div",[t.state.file?e("img",{ref:"img",staticClass:"img",attrs:{src:t.state.dataURL}}):t._e(),e("br"),e("div",{staticClass:"upload"},[e("input",{attrs:{type:"file",multiple:"",accept:"image/*"},on:{change:t.selectImg}}),e("Icon",{staticClass:"upload-icon",attrs:{type:"md-add"}})],1),e("div",{staticClass:"cut-box",on:{mousedown:t.mouseDown,mousemove:t.mouseMove,mouseup:t.mouseUp}},[e("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:300,height:300}}),e("div",{staticClass:"mask"})]),e("div",{staticClass:"avatar-box"},[t.state.avatarDataURL?e("img",{attrs:{src:t.state.avatarDataURL}}):t._e()]),e("div",[e("Button",{attrs:{type:"primary",size:"small"},on:{click:t.bigger}},[t._v("放大")]),e("Button",{attrs:{type:"primary",size:"small"},on:{click:t.smaller}},[t._v("缩小")]),e("Button",{attrs:{type:"primary",size:"small"},on:{click:t.cutPic}},[t._v("确定")]),e("Button",{attrs:{type:"primary",size:"small"},on:{click:t.upload}},[t._v("上传")])],1)])])],1)},i=[],l=a(7327),r=(a(2801),a(3767),a(8585),a(8696),a(9203)),o=function(t,e,a,s){var i,l=arguments.length,r=l<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,a):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(t,e,a,s);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(r=(l<3?i(r):l>3?i(e,a,r):i(e,a))||r);return l>3&&r&&Object.defineProperty(e,a,r),r};let n=class extends r.w3{constructor(...t){super(...t),(0,l.Z)(this,"state",{file:null,dataURL:"",zoomMultiple:1,startX:0,startY:0,isDrag:!1,lastX:0,lastY:0,avatarDataURL:""})}selectImg(t){if(t.target.files.length>0){let e=t.target.files[0],a=new FileReader;a.onloadend=t=>{this.state.file=e,this.state.dataURL=a.result,this.$nextTick((()=>{this.$refs.img.onload=()=>{this.drawImage()}}))},a.readAsDataURL(e)}}drawImage(t=this.state.lastX,e=this.state.lastX){let a=this.$refs.img,s=this.$refs.canvas,i=s.getContext("2d");i.clearRect(0,0,s.width,s.height);let l=a.width,r=a.height;if(l>r){let t=s.width/l;l=s.width*this.state.zoomMultiple,r=r*t*this.state.zoomMultiple}else{let t=s.height/r;l=l*t*this.state.zoomMultiple,r=s.height*this.state.zoomMultiple}i.drawImage(a,(s.width-l)/2+t,(s.height-r)/2+e,l,r)}mouseDown(t){this.state.startX=t.clientX,this.state.startY=t.clientY,this.state.isDrag=!0}mouseMove(t){this.state.isDrag&&this.drawImage(t.clientX-this.state.startX+this.state.lastX,t.clientY-this.state.startY+this.state.lastY)}mouseUp(t){this.state.lastX=t.clientX-this.state.startX+this.state.lastX,this.state.lastY=t.clientY-this.state.startY+this.state.lastY,this.state.isDrag=!1}bigger(){this.state.file&&(this.state.zoomMultiple+=.1,this.drawImage())}smaller(){this.state.file&&(this.state.zoomMultiple-=.1,this.drawImage())}cutPic(){if(!this.state.file)return;let t=this.$refs.canvas,e=t.getContext("2d");const a=e.getImageData(100,100,100,100);let s=document.createElement("canvas");s.width=100,s.height=100;let i=s.getContext("2d");i.putImageData(a,0,0);let l=s.toDataURL();this.state.avatarDataURL=l}upload(){if(""===this.state.avatarDataURL)return;let t=atob(this.state.avatarDataURL.split(",")[1]),e=new ArrayBuffer(t.length),a=new Uint8Array;for(let r=0;r<t.length;r++)a[r]=t.charCodeAt[r];let s=new Blob([e],{type:"image/png"}),i=new XMLHttpRequest,l=new FormData;l.append("avatar",s),i.open("POST","/upload"),i.send(l)}};n=o([(0,r.wA)({name:"CanvasCom",components:{}})],n);var h=n,c=h,u=a(3736),m=(0,u.Z)(c,s,i,!1,null,"0428e4a0",null),d=m.exports}}]);